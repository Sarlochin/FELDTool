# Copyright (c) 2023 Jan Feldhoff
#
# Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated
# documentation files (the "Software"), to deal in the Software without restriction, including without limitation the
# rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software,
# and to permit persons to whom the Software is furnished to do so, subject to the following conditions:
#
# The above copyright notice and this permission notice shall be included in all copies or substantial portions of
# the Software.
#
# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO
# THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
# AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
# TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
# SOFTWARE.


ParameterRegisterData = [
    [0x3020, 1, "Brake start time [ms] Motor 1", "Brake", 0, 0],
    [0x3020, 2, "Brake start time [ms] Motor 2", "Brake", 0, 0],
    [0x3021, 1, "Brake stop time [ms] Motor 1", "Brake", 2000, 2000],
    [0x3021, 2, "Brake stop time [ms] Motor 2", "Brake", 2000, 2000],
    [0x3022, 1, "Brake full on time [ms] Motor 1", "Brake", 1000, 1000],
    [0x3022, 2, "Brake full on time [ms] Motor 2", "Brake", 1000, 1000],
    [0x3023, 1, "Brake Voltage [24V] Motor 1", "Brake", 0.999969482421875, 0.999969482421875],
    [0x3023, 2, "Brake Voltage [24V] Motor 2", "Brake", 0.999969482421875, 0.999969482421875],
    [0x3024, 1, "Force released brake [] Motor 1", "Brake", 0, 0],
    [0x3024, 2, "Force released brake [] Motor 2", "Brake", 0, 0],
    [0x3025, 1, "Force closed brake [] Motor 1", "Brake", 0, 0],
    [0x3025, 2, "Force closed brake [] Motor 2", "Brake", 0, 0],
    [0x3026, 1, "Brake stop speed [rpm] Motor 1", "Brake", 0, 0],
    [0x3026, 2, "Brake stop speed [rpm] Motor 2", "Brake", 0, 0],
    [0x3029, 1, "Brake to control disable time [ms] Motor 1", "Brake", 1000, 1000],
    [0x3029, 2, "Brake to control disable time [ms] Motor 2", "Brake", 1000, 1000],
    [0x2000, 1, "CAN Node-ID", "Communication", 126, -1],
    [0x2000, 2, "CAN Baudrate", "Communication", 2, 2],
    [0x2001, -1, "Node state", "Communication", -1, -1],
    [0x20FC, -1, "Disable ready signal []", "Function", 0, 0],
    [0x20FD, -1, "Invert digital inputs []", "Function", 0, 0],
    [0x20FE, -1, "Debounce time digital inputs [ms]", "Function", 5, 5],
    [0x3013, 1, "Invert direction [] Motor 1", "Function", 0, 1],
    [0x3013, 2, "Invert direction [] Motor 2", "Function", 0, 0],
    [0x3015, 1, "Use encoder [] Motor 1", "Function", 1, 1],
    [0x3015, 2, "Use encoder [] Motor 2", "Function", 1, 1],
    [0x3016, 1, "Use PT1000 [] Motor 1", "Function", 1, 1],
    [0x3016, 2, "Use PT1000 [] Motor 2", "Function", 1, 1],
    [0x3017, 1, "Enable cogging compensation [] Motor 1", "Function", 0, 0],
    [0x3017, 2, "Enable cogging compensation [] Motor 2", "Function", 0, 0],
    [0x3018, 1, "Cogging averaging window [] Motor 1", "Function", 20, 20],
    [0x3018, 2, "Cogging averaging window [] Motor 2", "Function", 20, 20],
    [0x3027, 1, "Use CAN enable [] Motor 1", "Function", 1, 1],
    [0x3027, 2, "Use CAN enable [] Motor 2", "Function", 1, 1],
    [0x605A, 1, "Quick stop option code [] Motor 1", "Function", 0, 1],
    [0x605A, 2, "Quick stop option code [] Motor 2", "Function", 0, 1],
    [0x6060, 1, "Modes of operation [SET ONLY] Motor 1", "Function", 6, -1],
    [0x6060, 2, "Modes of operation [SET ONLY] Motor 2", "Function", 6, -1],
    [0x6061, 1, "Modes of operation display [DISPLAY ONLY] Motor 1", "Function", 6, -1],
    [0x6061, 2, "Modes of operation display [DISPLAY ONLY] Motor 2", "Function", 6, -1],
    [0x300C, 2, "Braking chopper voltage [V] Motor 2", "Motor Parameter", 60, 60],
    [0x3003, 1, "Nominal current Motor 1", "Motor Parameter", 27.600000381469727, 27.600000381469727],
    [0x3003, 2, "Nominal current Motor 2", "Motor Parameter", 27.600000381469727, 27.600000381469727],
    [0x3004, 1, "Nominal speed Motor 1", "Motor Parameter", 2666, 1862],
    [0x3004, 2, "Nominal speed Motor 2", "Motor Parameter", 2666, 1862],
    [0x3009, 1, "Current limit [A] Motor 1", "Motor Parameter", 44.5, 44.5],
    [0x3009, 2, "Current limit [A] Motor 2", "Motor Parameter", 44.5, 44.5],
    [0x300A, 1, "I2t peak current [A] Motor 1", "Motor Parameter", 63, 63],
    [0x300A, 2, "I2t peak current [A] Motor 2", "Motor Parameter", 63, 63],
    [0x300B, 1, "I2t peak time [A] Motor 1", "Motor Parameter", 13, 13],
    [0x300B, 2, "I2t peak time [A] Motor 2", "Motor Parameter", 13, 13],
    [0x300C, 1, "Braking chopper voltage [V] Motor 1", "Motor Parameter", 60, 60],
    [0x300F, 1, "Overtemperature threshold [] Motor 1", "Motor Parameter", 0.003753662109375, 0.003753662109375],
    [0x300F, 2, "Overtemperature threshold [] Motor 2", "Motor Parameter", 0.003753662109375, 0.003753662109375],
    [0x3011, 1, "Ramp acceleration [rpm/s] Motor 1", "Motor Parameter", 579.3200073242180, 579.3200073242180],
    [0x3011, 2, "Ramp acceleration [rpm/s] Motor 2", "Motor Parameter", 579.3200073242180, 579.3200073242180],
    [0x3012, 1, "Ramp deceleration [rpm/s] Motor 1", "Motor Parameter", 579.3200073242180, 579.3200073242180],
    [0x3012, 2, "Ramp deceleration [rpm/s] Motor 2", "Motor Parameter", 579.3200073242180, 579.3200073242180],
    [0x6046, 1, "Velocity min amount [rpm] Motor 1", "Motor Parameter", 0, 0],
    [0x6046, 2, "Velocity max amount [rpm] Motor 1", "Motor Parameter", 10000, 2666],
    [0x6046, 3, "Velocity min amount [rpm] Motor 2", "Motor Parameter", 0, -1],
    [0x6046, 4, "Velocity max amount [rpm] Motor 2", "Motor Parameter", 10000, 2666],
    [0x6085, 1, "Quick stop 1 [A] Motor 1", "Motor Parameter", 1, -1],
    [0x6085, 2, "Quick stop 2 [A] Motor 1", "Motor Parameter", 2, -1],
    [0x6085, 3, "Quick stop ramp [rpm/s] Motor 1", "Motor Parameter", 1000, -1],
    [0x6085, 4, "Quick stop time limit [ms] Motor 1", "Motor Parameter", 2000, -1],
    [0x6085, 5, "Quick stop 1 [A] Motor 2", "Motor Parameter", 1, -1],
    [0x6085, 6, "Quick stop 2 [A] Motor 2", "Motor Parameter", 2, -1],
    [0x6085, 7, "Quick stop ramp [rpm/s] Motor 2", "Motor Parameter", 1000, -1],
    [0x6085, 8, "Quick stop time limit [ms] Motor 2", "Motor Parameter", 2000, -1],
    [0x300D, 1, "Velocity follow error window [rpm] Motor 1", "Motor Tune", 1000, 1000],
    [0x300D, 2, "Velocity follow error window [rpm] Motor 2", "Motor Tune", 1000, 1000],
    [0x300E, 1, "Velocity follow error time [ms] Motor 1", "Motor Tune", 1000, 1000],
    [0x300E, 2, "Velocity follow error time [ms] Motor 2", "Motor Tune", 1000, 1000],
    [0x301A, 1, "Acceleration pre-gain [] Motor 1", "Motor Tune", 0, 0],
    [0x301A, 2, "Acceleration pre-gain [] Motor 2", "Motor Tune", 0, 0],
    [0x301D, 1, "Ramp jerk [rpm/s/s] Motor 1", "Motor Tune", 1000000, 1000000],
    [0x301D, 2, "Ramp jerk [rpm/s/s] Motor 2", "Motor Tune", 1000000, 1000000],
    [0x60F6, 1, "Torque control Kp [] Motor 1", "Motor Tune", 0.699999988079071, 0.699999988079071],
    [0x60F6, 2, "Torque control Ki [] Motor 1", "Motor Tune", 1000, 1000],
    [0x60F6, 3, "Torque control Kp [] Motor 2", "Motor Tune", 0.699999988079071, 0.699999988079071],
    [0x60F6, 4, "Torque control Ki [] Motor 2", "Motor Tune", 1000, 1000],
    [0x60F9, 1, "Velocity control Kp [] Motor 1", "Motor Tune", 0.5600000023841858, 0.5600000023841858],
    [0x60F9, 2, "Velocity control Ki [] Motor 1", "Motor Tune", 0, 0],
    [0x60F9, 3, "Velocity control Kd [] Motor 1", "Motor Tune", 0.003000000026077032, 0.003000000026077032],
    [0x60F9, 4, "Velocity control fc [] Motor 1", "Motor Tune", 100.0, 100.0],
    [0x60F9, 5, "Velocity control Kp [] Motor 2", "Motor Tune", 0.5600000023841858, 0.5600000023841858],
    [0x60F9, 6, "Velocity control Ki [] Motor 2", "Motor Tune", 0, 0],
    [0x60F9, 7, "Velocity control Kd [] Motor 2", "Motor Tune", 0.003000000026077032, 0.003000000026077032],
    [0x60F9, 8, "Velocity control fc [] Motor 2", "Motor Tune", 100.0, 100.0]
]

NodeStates = {
    4: "Stopped",
    5: "Operational",
    127: "Pre-operational"
}

ErrorRegisterStates = {
    0x1: "Current error",
    0x2: "Voltage error",
    0x3: "Temperature error",
    0x4: "Communication error",
    0x5: "Device proﬁle speciﬁc error",
    0x6: "Reserved",
    0x7: "Manufacturer speciﬁc error",
    0x20: "Unknown"
}

PreDefinedErrorFieldAppStates = {
    0x0: "CAN-DSP",
    0x1: "Motor_1-DSP",
    0x2: "Motor_2-DSP",
    0x4: "App-DSP"
}
PreDefinedErrorFieldStates = {
    0x1000: "Generic error",
    0x2210: "Current sensor error",
    0x2310: "Overcurrent error",
    0x2311: "Overcurrent error fast response",
    0x2312: "Overcurrent error slow response",
    0x2320: "Overcurrent brake chopper error",
    0x3110: "Overvoltage error",
    0x3120: "Undervoltage error",
    0x4210: "Overtemperature electronics",
    0x4211: "Overtemperature motor",
    0x4212: "Open motor temperature contact",
    0x4220: "Overtemperature brake chopper",
    0x4310: "Motor thermal overload / Overtemperature motor (I2t error)",
    0x5510: "STO PCB not ready / 12V supply undervoltage error",
    0x6010: "Software reset",
    0x6100: "Internal software error (NVM error)",
    0x6110: "Internal communication timeout",
    0x6320: "Parameter error",
    0x7410: "Hall identiﬁcation error",
    0x8100: "CAN communication error",
    0x8110: "CAN overrun error",
    0x8120: "CAN passive error",
    0x8130: "CAN guard error",
    0x8140: "CAN bus off error",
    0x8150: "CAN COB collision error",
    0x8210: "CAN PDO length error",
    0x8220: "CAN PDO length overrun error",
    0x8300: "Cogging torque identiﬁcation error / Offset angle detection error",
    0x8400: "Emergency stop initiated",
    0x8600: "Positioning / Homing error",
    0x8601: "Position synchronization error",
    0x8602: "Error in master frequency mode (mode of operation = 10 and master frequency)",
    0x8603: "Positioning / Homing error",
    0x8604: "Positioning / Homing error",
    0x8611: "Position following error",
    0x8612: "Velocity following error",
    0x8613: "Position following error (in velocity mode)"
}

FaultRegisterAllSubs = {
    0x10000000: ["ERROR_NVM_READ", "Software error: Error at reading non-volatile memory"],
    0x20000000: ["ERROR_NVM_WRITE", "Software error: Error writing non-volatile memory"],
    0x40000000: ["ERROR_NVM_OVERFLOW", "Software error: Buffer overﬂow of non-volatile memory"],
    0x80000000: ["ERROR_NVM_VERSION", "Software error: Checksum mismatch of buffer and application"]
}
FaultRegisterApplication = {
    0x00000010: ["ERROR_U24V_MAX", "24V supply over voltage error, Supply voltage for control electronics above 28V"],
    0x00000020: ["ERROR_U24V_MIN", "24V supply under voltage error, Supply voltage for control electronics below 20V"],
    0x00000100: ["ERROR_TMP_PCB_ISO", "signal PCB temperature error"],
    0x00001000: ["ERROR_SLAVE1_NOT_READY", "Motor-DSP 1 not ready"],
    0x00002000: ["ERROR_SLAVE2_NOT_READY", "Motor-DSP 2 not ready"],
    0x00004000: ["ERROR_CAN_NOT_READY", "CAN-DSP not ready"],
    0x00010000: ["ERROR_TIMEOUT_CAN_MST", "Communication Timeout Fieldbus(CAN/Proﬁnet) - Application-DSP"],
    0x00020000: ["ERROR_TIMEOUT_SLV1_MST", "Communication Timeout Motor-DSP 1 - Application-DSP"],
    0x00040000: ["ERROR_TIMEOUT_SLV2_MST", "Communication Timeout Motor-DSP 2 - Application-DSP"],
    0x00100000: ["ERROR_SLAVE1_MONITOR_STATE", "Motor-DSP 1 in monitor (bootloader) state"],
    0x00200000: ["ERROR_SLAVE2_MONITOR_STATE", "Motor-DSP 2 in monitor (bootloader) state"],
    0x00400000: ["ERROR_SLAVE1_SYNC", "Motor-DSP 1 has an error in the synchronous mode"],
    0x00800000: ["ERROR_SLAVE2_SYNC", "Motor-DSP 2 has an error in the synchronous mode"],
    0x01000000: ["ERROR_HOMING_SYNC", "Movement in opposite direction during homing for too long"],
    0x02000000: ["ERROR_MASTER_FREQU", "Error in masterfrequency mode. At least one controller has an error"]
}
FaultRegisterMotor = {
    0x00000001: ["ERROR_OVER_CURRENT", "Over current error (software, fast response, 113A peak for 2ms)"],
    0x00000002: ["ERROR_OVER_CURRENT2", "Over current error (software, slow response, 100A peak for 1000ms)"],
    0x00000003: ["ERROR_CURRENT_MEASUREMENT",
                 "Current sensor error, the current sensor could not be correctly calibrated"],
    0x00000008: ["ERROR_TRIPZONE", "Fault inputs triggered (hardware), hardware overcurrent"],
    0x00000010: ["WARNING_UDC_MAX", "DC-Link over voltage error (above 63V)"],
    0x00000020: ["WARNING_UDC_MIN", "DC-Link under voltage error (below 10V)"],
    0x00000040: ["WARNING_U12V_MIN",
                 "12V supply under voltage error (below 9V), Error occurs if the STO-PCB is not ready"],
    0x00000100: ["ERROR_TMP_PCB", "Power PCB overtemperature error"],
    0x00000200: ["ERROR_TMP_MOTOR", "Motor overtemperature error"],
    0x00000400: ["ERROR_I2T", "I2T error"],
    0x00000800: ["ERROR_TMP_MOTOR_CONTACT", "Open motor temperature contact"],
    0x00001000: ["ERROR_OC_HW", "Overcurrent Hardware was triggerd"],
    0x00002000: ["ERROR_EMCY_STOP", "Emergency Stop"],
    0x00004000: ["ERROR_FAULT_OC_CHOPPER", "Overcurrent at brake chopper output"],
    0x00008000: ["ERROR_TMP_CHOPPER", "Brake chopper temperature error"],
    0x00010000: ["ERROR_TIMEOUT_MST_SLV", "Communication Timeout Application-DSP - Motor-DSP"],
    0x00020000: ["ERROR_SPEED_DIFF", "Speed difference Error, velocity following error window has been exceeded"],
    0x00040000: ["ERROR_POSITION_DIFF", "Position difference Error, position following error window has been exceeded"],
    0x00080000: ["ERROR_HOMING_RANGE", "Homing range error, no homing signal was found within the homing range"],
    0x00100000: ["ERROR_COGG_IDENT_DONE", "Cogging torque identiﬁcation sucessfully ﬁnished"],
    0x00200000: ["ERROR_COGG_IDENT_NO_INDEX",
                 "No index signal was found during the cogging torque identiﬁcation procedure"],
    0x00400000: ["ERROR_COGG_IDENT_POS_CONT",
                 "The position controller doesn’t ﬁnd a stable position during cogging torque identiﬁcation procedure"],
    0x00800000: ["ERROR_HALL_IDENT",
                 "Hall signals could not correctly detected during angular offset identiﬁcation procedure"],
    0x01000000: ["ERROR_POS_DIFF_SPEED_CONT",
                 "The trajectory-generating speed controller observes a too high position difference"],
    0x02000000: ["ERROR_HOMING_ES_LEAVE_TIME", "Endswitch leave time was exceed during homing"]
}
